<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>file-mode.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Bucket.html">Bucket</a><ul class='methods'><li data-type='method'><a href="Bucket.html#addActor">addActor</a></li><li data-type='method'><a href="Bucket.html#create">create</a></li><li data-type='method'><a href="Bucket.html#exists">exists</a></li><li data-type='method'><a href="Bucket.html#file">file</a></li><li data-type='method'><a href="Bucket.html#getIndex">getIndex</a></li><li data-type='method'><a href="Bucket.html#getMetadata">getMetadata</a></li><li data-type='method'><a href="Bucket.html#indexFile">indexFile</a></li><li data-type='method'><a href="Bucket.html#open">open</a></li></ul></li><li><a href="File.html">File</a><ul class='methods'><li data-type='method'><a href="File.html#create">create</a></li><li data-type='method'><a href="File.html#exists">exists</a></li><li data-type='method'><a href="File.html#getLastchange">getLastchange</a></li><li data-type='method'><a href="File.html#getMetadata">getMetadata</a></li><li data-type='method'><a href="File.html#open">open</a></li><li data-type='method'><a href="File.html#read">read</a></li><li data-type='method'><a href="File.html#save">save</a></li></ul></li><li><a href="FsStorage.html">FsStorage</a><ul class='methods'><li data-type='method'><a href="FsStorage.html#fileExists">fileExists</a></li><li data-type='method'><a href="FsStorage.html#readDir">readDir</a></li><li data-type='method'><a href="FsStorage.html#readFile">readFile</a></li><li data-type='method'><a href="FsStorage.html#rmFile">rmFile</a></li><li data-type='method'><a href="FsStorage.html#start">start</a></li><li data-type='method'><a href="FsStorage.html#stop">stop</a></li><li data-type='method'><a href="FsStorage.html#touchDir">touchDir</a></li><li data-type='method'><a href="FsStorage.html#writeFile">writeFile</a></li></ul></li><li><a href="GCEStorage.html">GCEStorage</a><ul class='methods'><li data-type='method'><a href="GCEStorage.html#fileExists">fileExists</a></li><li data-type='method'><a href="GCEStorage.html#readDir">readDir</a></li><li data-type='method'><a href="GCEStorage.html#readFile">readFile</a></li><li data-type='method'><a href="GCEStorage.html#rmFile">rmFile</a></li><li data-type='method'><a href="GCEStorage.html#start">start</a></li><li data-type='method'><a href="GCEStorage.html#stop">stop</a></li><li data-type='method'><a href="GCEStorage.html#touchDir">touchDir</a></li><li data-type='method'><a href="GCEStorage.html#writeFile">writeFile</a></li></ul></li><li><a href="Gpgfs.html">Gpgfs</a><ul class='methods'><li data-type='method'><a href="Gpgfs.html#bucket">bucket</a></li><li data-type='method'><a href="Gpgfs.html#cacheWhoami">cacheWhoami</a></li><li data-type='method'><a href="Gpgfs.html#getBuckets">getBuckets</a></li><li data-type='method'><a href="Gpgfs.html#open">open</a></li></ul></li><li><a href="IStorage.html">IStorage</a><ul class='methods'><li data-type='method'><a href="IStorage.html#assertEnabled">assertEnabled</a></li><li data-type='method'><a href="IStorage.html#checksumFile">checksumFile</a></li><li data-type='method'><a href="IStorage.html#fileExists">fileExists</a></li><li data-type='method'><a href="IStorage.html#readDir">readDir</a></li><li data-type='method'><a href="IStorage.html#readFile">readFile</a></li><li data-type='method'><a href="IStorage.html#rmFile">rmFile</a></li><li data-type='method'><a href="IStorage.html#start">start</a></li><li data-type='method'><a href="IStorage.html#stop">stop</a></li><li data-type='method'><a href="IStorage.html#touchDir">touchDir</a></li><li data-type='method'><a href="IStorage.html#writeFile">writeFile</a></li></ul></li><li><a href="SFTPStorage.html">SFTPStorage</a><ul class='methods'><li data-type='method'><a href="SFTPStorage.html#fileExists">fileExists</a></li><li data-type='method'><a href="SFTPStorage.html#readDir">readDir</a></li><li data-type='method'><a href="SFTPStorage.html#readFile">readFile</a></li><li data-type='method'><a href="SFTPStorage.html#rmFile">rmFile</a></li><li data-type='method'><a href="SFTPStorage.html#start">start</a></li><li data-type='method'><a href="SFTPStorage.html#stop">stop</a></li><li data-type='method'><a href="SFTPStorage.html#touchDir">touchDir</a></li><li data-type='method'><a href="SFTPStorage.html#writeFile">writeFile</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#S_IFMT">S_IFMT</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">file-mode.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Copy from - https://github.com/devsnek/fused/blob/master/src/index.js
 * Constants (defined in `stat.h`).
 */

const S_IFMT = 61440; /* 0170000 type of file */
const S_IFIFO = 4096; /* 0010000 named pipe (fifo) */
const S_IFCHR = 8192; /* 0020000 character special */
const S_IFDIR = 16384; /* 0040000 directory */
const S_IFBLK = 24576; /* 0060000 block special */
const S_IFREG = 32768; /* 0100000 regular */
const S_IFLNK = 40960; /* 0120000 symbolic link */
const S_IFSOCK = 49152; /* 0140000 socket */
const S_IFWHT = 57344; /* 0160000 whiteout */
const S_ISUID = 2048; /* 0004000 set user id on execution */
const S_ISGID = 1024; /* 0002000 set group id on execution */
const S_ISVTX = 512; /* 0001000 save swapped text even after use */
const S_IRUSR = 256; /* 0000400 read permission, owner */
const S_IWUSR = 128; /* 0000200 write permission, owner */
const S_IXUSR = 64; /* 0000100 execute/search permission, owner */
const S_IRGRP = 32; /* 0000040 read permission, group */
const S_IWGRP = 16; /* 0000020 write permission, group */
const S_IXGRP = 8; /* 0000010 execute/search permission, group */
const S_IROTH = 4; /* 0000004 read permission, others */
const S_IWOTH = 2; /* 0000002 write permission, others */
const S_IXOTH = 1; /* 0000001 execute/search permission, others */

class Mode {
  constructor(options = {}) {
    this.mode = typeof options === 'number' ? options : 0;
    this.owner = new Permissions(this, S_IRUSR, S_IWUSR, S_IXUSR, options.owner);
    this.group = new Permissions(this, S_IRGRP, S_IWGRP, S_IXGRP, options.group);
    this.others = new Permissions(this, S_IROTH, S_IWOTH, S_IXOTH, options.others);
    if (options.type) {
      switch (options.type) {
        case 'dir':
        case 'directory':
          this.isDirectory(true);
          break;
        case 'file':
          this.isFile(true);
          break;
        case 'block':
          this.isBlockDevice(true);
          break;
        case 'character':
          this.isCharacterDevice(true);
          break;
        case 'symlink':
          this.isSymbolicLink(true);
          break;
        case 'fifo':
          this.isFIFO(true);
          break;
        case 'socket':
          this.isSocket(true);
          break;
      }
    }
    const check = options &amp;&amp; typeof options === 'object';
    if (check &amp;&amp; Reflect.has(options, 'setuid')) this.setuid = options.setuid;
    if (check &amp;&amp; Reflect.has(options, 'setgid')) this.setgid = options.setgid;
  }

  valueOf() {
    return this.mode;
  }

  toString() { // eslint-disable-line complexity
    const str = [];
    // file type
    if (this.isDirectory()) {
      str.push('d');
    } else if (this.isFile()) {
      str.push('-');
    } else if (this.isBlockDevice()) {
      str.push('b');
    } else if (this.isCharacterDevice()) {
      str.push('c');
    } else if (this.isSymbolicLink()) {
      str.push('l');
    } else if (this.isFIFO()) {
      str.push('p');
    } else if (this.isSocket()) {
      str.push('s');
    } else {
      throw new TypeError('unexpected "file type"');
    }
    // owner read, write, execute
    str.push(this.owner.read ? 'r' : '-');
    str.push(this.owner.write ? 'w' : '-');
    if (this.setuid) {
      str.push(this.owner.execute ? 's' : 'S');
    } else {
      str.push(this.owner.execute ? 'x' : '-');
    }
    // group read, write, execute
    str.push(this.group.read ? 'r' : '-');
    str.push(this.group.write ? 'w' : '-');
    if (this.setgid) {
      str.push(this.group.execute ? 's' : 'S');
    } else {
      str.push(this.group.execute ? 'x' : '-');
    }
    // others read, write, execute
    str.push(this.others.read ? 'r' : '-');
    str.push(this.others.write ? 'w' : '-');
    if (this.sticky) {
      str.push(this.others.execute ? 't' : 'T');
    } else {
      str.push(this.others.execute ? 'x' : '-');
    }
    return str.join('');
  }

  _checkModeProperty(property, set) {
    const mode = this.mode;
    if (set) this.mode = (mode | S_IFMT) &amp; property | mode &amp; ~S_IFMT;
    return (mode &amp; S_IFMT) === property;
  }

  isDirectory(v) {
    return this._checkModeProperty(S_IFDIR, v);
  }

  isFile(v) {
    return this._checkModeProperty(S_IFREG, v);
  }

  isBlockDevice(v) {
    return this._checkModeProperty(S_IFBLK, v);
  }

  isCharacterDevice(v) {
    return this._checkModeProperty(S_IFCHR, v);
  }

  isSymbolicLink(v) {
    return this._checkModeProperty(S_IFLNK, v);
  }

  isFIFO(v) {
    return this._checkModeProperty(S_IFIFO, v);
  }

  isSocket(v) {
    return this._checkModeProperty(S_IFSOCK, v);
  }

  get setuid() {
    return Boolean(this.mode &amp; S_ISUID);
  }
  set setuid(v) {
    if (v) {
      this.mode |= S_ISUID;
    } else {
      this.mode &amp;= ~S_ISUID;
    }
  }

  get setgid() {
    return Boolean(this.mode &amp; S_ISGID);
  }
  set setgid(v) {
    if (v) {
      this.mode |= S_ISGID;
    } else {
      this.mode &amp;= ~S_ISGID;
    }
  }

  get sticky() {
    return Boolean(this.mode &amp; S_ISVTX);
  }
  set sticky(v) {
    if (v) {
      this.mode |= S_ISVTX;
    } else {
      this.mode &amp;= ~S_ISVTX;
    }
  }
}

function Permissions(mode, READ, WRITE, EXECUTE, options = {}) {
  const ret = {
    get read() { return Boolean(mode.mode &amp; READ); },
    set read(v) {
      if (v) {
        mode.mode |= READ;
      } else {
        mode.mode &amp;= ~READ;
      }
    },

    get write() { return Boolean(mode.mode &amp; WRITE); },
    set write(v) {
      if (v) {
        mode.mode |= WRITE;
      } else {
        mode.mode &amp;= ~WRITE;
      }
    },

    get execute() { return Boolean(mode.mode &amp; EXECUTE); },
    set execute(v) {
      if (v) {
        mode.mode |= EXECUTE;
      } else {
        mode.mode &amp;= ~EXECUTE;
      }
    },
  };

  if (options &amp;&amp; Reflect.has(options, 'read')) ret.read = options.read;
  if (options &amp;&amp; Reflect.has(options, 'write')) ret.write = options.write;
  if (options &amp;&amp; Reflect.has(options, 'execute')) ret.execute = options.execute;

  return ret;
}

module.exports = Mode;</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Wed Feb 26 2020 17:28:29 GMT-0800 (Pacific Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
